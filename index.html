<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <!-- OCR åº“ -->
    <script src='https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js'></script>
    <title>ä¸ªäººä»»åŠ¡çœ‹æ¿</title>
    <style>
        :root {
            --bg-body: #f2f3f5;
            --bg-card: #ffffff;
            --text-main: #1f2329;
            --text-sub: #8f959e;
            --radius: 12px;
            --font-scale: 1;
            --pc-width: 600px; /* PCç«¯é»˜è®¤å®½åº¦ */
            
            --blue: #3370ff; --green: #00b665; --red: #f54a45;
            --orange: #ff8800; --purple: #9333ea; --border: #dee0e3;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body); color: var(--text-main);
            margin: 0; padding: 15px;
            font-size: calc(14px * var(--font-scale));
            padding-bottom: 120px;
        }

        /* PCç«¯è‡ªé€‚åº”å¸ƒå±€ */
        #app-container { 
            display: flex; flex-direction: column; gap: 15px; 
            margin: 0 auto; /* å±…ä¸­ */
            width: 100%;
            max-width: var(--pc-width); /* PCç«¯å®½åº¦æ§åˆ¶ */
            transition: max-width 0.3s ease;
        }

        .section-block { 
            touch-action: pan-y; transition: transform 0.2s, opacity 0.2s; position: relative; 
        }
        .section-block.dragging { opacity: 0.9; transform: scale(1.02); z-index: 1000; box-shadow: 0 15px 30px rgba(0,0,0,0.15); user-select: none; }
        
        /* å›ºå®šå¡ç‰‡æ ·å¼ */
        .section-block.pinned .card { border: 2px solid var(--orange); }
        .section-block.pinned::after {
            content: 'ğŸ“Œ'; position: absolute; top: -10px; right: -5px; font-size: 1.2em;
            background: #fff; border-radius: 50%; padding: 2px; box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .card { background: var(--bg-card); border-radius: var(--radius); padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid var(--border); position: relative; }

        /* æ§ä»¶ */
        .btn { border: none; border-radius: var(--radius); padding: 8px 16px; font-size: 0.95em; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; transition: opacity 0.2s; white-space: nowrap;}
        .btn:active { opacity: 0.8; }
        .btn-primary { background: var(--blue); color: white; }
        .btn-outline { border: 1px solid var(--border); background: transparent; color: var(--text-main); }
        .btn-text { background: transparent; color: var(--text-sub); }
        
        input, textarea { 
            border: 1px solid var(--border); border-radius: var(--radius); padding: 10px; 
            font-size: 1em; background: var(--bg-card); width: 100%; outline: none; 
            transition: border-color 0.2s; font-family: inherit;
        }
        input:focus, textarea:focus { border-color: var(--blue); }
        .seamless-input { border: 1px solid transparent; background: transparent; padding: 2px 4px; margin: -2px; width: 100%; }
        .seamless-input:focus { border: 1px solid var(--blue); background: #fff; border-radius: 4px; }

        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; max-width: var(--pc-width); margin: 0 auto 15px auto;}
        .app-title { font-weight: 800; font-size: 1.4em; }
        .sys-time { font-size: 0.9em; color: var(--text-sub); font-family: monospace; font-weight: bold; }

        /* KPI å¯ç‚¹å‡» */
        .kpi-row { display: flex; gap: 10px; }
        .kpi-item { flex: 1; text-align: center; cursor: pointer; border-radius: 8px; transition: background 0.2s; }
        .kpi-item:active { background: rgba(0,0,0,0.05); }
        .big-num { font-size: 1.8em; font-weight: 800; line-height: 1.2; }
        .label-text { font-size: 0.8em; color: var(--text-sub); margin-top: 4px; }

        /* å›¾è¡¨ */
        .charts-container { display: flex; flex-direction: column; gap: 20px; }
        .chart-section-title { font-size: 0.9em; font-weight: bold; border-left: 3px solid var(--blue); padding-left: 8px; margin-bottom: 8px;}
        .pie-row { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
        .pie-card { flex: 1; min-width: 110px; background: #f9f9f9; padding: 10px; border-radius: var(--radius); display: flex; flex-direction: column; align-items: center; border: 1px solid #eee; }
        .pie-chart { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff; margin-bottom: 8px; flex-shrink: 0; }
        .legend-box { display: flex; flex-direction: column; gap: 4px; width: 100%; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.7em; color: #666; }
        .legend-color { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }
        
        .bar-chart-row { display: flex; gap: 10px; height: 140px; }
        .bar-box { flex: 1; background: #f9f9f9; border-radius: var(--radius); padding: 10px; display: flex; flex-direction: column; border: 1px solid #eee; }
        .bar-area { flex: 1; display: flex; align-items: flex-end; gap: 6px; margin-bottom: 5px; border-bottom: 1px solid #e0e0e0; padding-bottom: 2px; }
        .bar-col { flex: 1; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; }
        .bar-fill { width: 100%; min-height: 4px; border-radius: calc(var(--radius) * 0.4) calc(var(--radius) * 0.4) 0 0; transition: height 0.3s; opacity: 0.9; }
        .bar-legend-row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }

        /* è‡ªå®šä¹‰ä¸‹æ‹‰ */
        .custom-select { position: relative; cursor: pointer; user-select: none; min-width: 90px; }
        .select-trigger { border: 1px solid var(--border); border-radius: var(--radius); padding: 8px 10px; background: var(--bg-card); display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; white-space: nowrap; overflow: hidden;}
        .select-trigger::after { content: 'â–¼'; font-size: 0.6em; color: #999; margin-left: 6px; }
        .select-options { position: absolute; top: 105%; left: 0; min-width: 100%; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: 0 5px 15px rgba(0,0,0,0.1); z-index: 100; display: none; max-height: 250px; overflow-y: auto; }
        .select-options.open { display: block; }
        .select-option { padding: 10px; font-size: 0.9em; border-bottom: 1px solid #f5f5f5; display: flex; align-items: center; gap: 6px; }

        /* åˆ—è¡¨ä¸ç­›é€‰ */
        .filter-row { display: flex; gap: 8px; margin-bottom: 12px; }
        .task-item { padding: 12px; border-bottom: 1px solid #f0f0f0; display: flex; flex-direction: column; gap: 6px; }
        .task-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
        .task-title-input { font-size: 1.05em; font-weight: 500; border: none; background: transparent; padding: 0; width: 100%; }
        .task-title-input.done { text-decoration: line-through; color: #ccc; }
        .task-meta { display: flex; align-items: center; gap: 5px; font-size: 0.8em; color: #999; margin-top:2px; }
        .task-ctrls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 4px; }
        .mini-select .select-trigger { padding: 3px 8px; font-size: 0.8em; min-width: auto; height: 26px; }
        .subtasks { margin-top: 5px; padding-left: 10px; border-left: 2px solid #eee; display: none; }
        .subtasks.show { display: block; }
        .sub-item { display: flex; align-items: center; gap: 8px; margin-top: 6px; font-size: 0.9em; }

        /* ç¬”è®°ä¸ç¯ç®± */
        .note-preview-area { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
        .note-thumb { height: 60px; border-radius: 6px; border: 1px solid #eee; cursor: zoom-in; object-fit: cover; }
        .note-item { margin-bottom: 12px; padding: 12px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
        .note-edit-area { width: 100%; background: transparent; border: none; resize: vertical; font-size: 0.95em; line-height: 1.5; font-family: inherit; }
        .note-edit-area:focus { background: #fff; outline: 1px solid var(--blue); border-radius: 4px; }
        .lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: none; justify-content: center; align-items: center; cursor: zoom-out; }
        .lightbox img { max-width: 95%; max-height: 95%; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }

        /* å›ºå®šæŒ‰é’® */
        .pin-btn { position: absolute; top: 10px; right: 10px; font-size: 1.2em; cursor: pointer; opacity: 0.3; z-index: 10; border:none; background:none;}
        .pin-btn.active { opacity: 1; transform: scale(1.1); }

        /* è®¾ç½®å¼¹çª— */
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: flex-end; z-index: 2000; }
        .modal-content { background: #fff; width: 100%; border-radius: 20px 20px 0 0; padding: 25px; animation: slideUp 0.3s; max-height: 80vh; overflow-y: auto; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .setting-item { margin-bottom: 20px; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; }
        .setting-label { display: block; font-weight: bold; margin-bottom: 8px; }

        /* é¢œè‰²ç±» */
        .bg-p1 { background: #fee2e2; color: #dc2626; } .bg-p2 { background: #dbeafe; color: #2563eb; } 
        .bg-p3 { background: #fef3c7; color: #d97706; } .bg-p4 { background: #f3f4f6; color: #4b5563; }
        .bg-work { background: #eff6ff; color: var(--blue); } .bg-study { background: #f3e8ff; color: var(--purple); } 
        .bg-life { background: #dcfce7; color: var(--green); }
        .bg-todo { background: #f5f5f5; color: #666; } .bg-doing { background: #e0edff; color: var(--blue); }
        .bg-done { background: #dcfce7; color: var(--green); }
    </style>
</head>
<body>
<div class="lightbox" id="lightbox" onclick="this.style.display='none'"><img id="lightbox-img" src=""></div>

    <div class="top-bar">
        <div class="app-title" data-i18n="title">ä¸ªäººä»»åŠ¡çœ‹æ¿</div>
        <div class="sys-time" id="sys-clock">00:00:00</div>
        <button class="btn btn-text" style="font-size:1.4em" onclick="openSettings()">âš™ï¸</button>
    </div>

    <div id="app-container">
        
        <!-- KPI (ç‚¹å‡»å¯ç­›é€‰) -->
        <div class="section-block" id="sec-kpi">
            <button class="pin-btn" onclick="togglePin('sec-kpi', this)">ğŸ“Œ</button>
            <div class="card">
                <div class="kpi-row">
                    <div class="kpi-item" onclick="filterByStat('todo')"><div class="label-text" data-i18n="todo">å¾…åŠ</div><div class="big-num" style="color:#999" id="kpi-todo">0</div></div>
                    <div class="kpi-item" onclick="filterByStat('doing')"><div class="label-text" data-i18n="doing">è¿›è¡Œä¸­</div><div class="big-num" style="color:var(--blue)" id="kpi-doing">0</div></div>
                    <div class="kpi-item" onclick="filterByStat('done')"><div class="label-text" data-i18n="done">å·²å®Œæˆ</div><div class="big-num" style="color:var(--green)" id="kpi-done">0</div></div>
                </div>
            </div>
        </div>

        <!-- Charts -->
        <div class="section-block" id="sec-chart">
            <button class="pin-btn" onclick="togglePin('sec-chart', this)">ğŸ“Œ</button>
            <div class="card charts-container">
                <div>
                    <div class="chart-section-title" data-i18n="dist">å¤šç»´åˆ†å¸ƒ</div>
                    <div class="pie-row">
                        <div class="pie-card"><div class="pie-chart" id="pie-tag"></div><div class="legend-box" id="leg-tag"></div></div>
                        <div class="pie-card"><div class="pie-chart" id="pie-cat"></div><div class="legend-box" id="leg-cat"></div></div>
                        <div class="pie-card"><div class="pie-chart" id="pie-status"></div><div class="legend-box" id="leg-status"></div></div>
                    </div>
                </div>
                <div class="bar-chart-row">
                    <div class="bar-box">
                        <div class="chart-section-title" data-i18n="stat_status">çŠ¶æ€ç»Ÿè®¡</div>
                        <div class="bar-area" id="bar-status-chart"></div>
                        <div class="bar-legend-row" id="bar-status-leg"></div>
                    </div>
                    <div class="bar-box">
                        <div class="chart-section-title" data-i18n="stat_urgency">ç´§æ€¥åº¦ç»Ÿè®¡</div>
                        <div class="bar-area" id="bar-urgency-chart"></div>
                        <div class="bar-legend-row" id="bar-urgency-leg"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add (è‡ªåŠ¨æ—¶é—´) -->
        <div class="section-block" id="sec-add">
            <button class="pin-btn" onclick="togglePin('sec-add', this)">ğŸ“Œ</button>
            <div class="card">
                <div style="font-weight:bold; margin-bottom:10px" data-i18n="add_title">âš¡ å¿«é€Ÿæ·»åŠ </div>
                <div style="display:flex; gap:10px; margin-bottom:10px">
                    <input type="text" id="add-title" placeholder="è¦åšä»€ä¹ˆï¼Ÿ(è‡ªåŠ¨è®°å½•æ—¶é—´)" style="flex:2" data-i18n-ph="add_ph">
                    <button class="btn btn-primary" onclick="addTask()" data-i18n="btn_add">æ·»åŠ </button>
                </div>
                <div style="display:flex; gap:10px">
                    <div class="custom-select" id="sel-add-tag" style="flex:1"></div>
                    <div class="custom-select" id="sel-add-cat" style="flex:1"></div>
                </div>
            </div>
        </div>

        <!-- Note (OCR ä¼˜åŒ–ç‰ˆ) -->
        <div class="section-block" id="sec-note">
            <button class="pin-btn" onclick="togglePin('sec-note', this)">ğŸ“Œ</button>
            <div class="card">
                <div style="font-weight:bold; margin-bottom:8px" data-i18n="note_title">çµæ„Ÿ / ç¬”è®° / æˆªå›¾</div>
                <textarea id="note-input" rows="3" placeholder="åœ¨æ­¤è®°å½•ï¼Œè‡ªåŠ¨ä¿å­˜..." data-i18n-ph="note_ph"></textarea>
                <div id="note-preview-area" class="note-preview-area"></div>
                <div style="display:flex; gap:8px; align-items:center; margin-top:5px">
                    <input type="file" id="img-upload" accept="image/*" style="display:none" onchange="handleImgUpload(this)">
                    <button class="btn btn-outline" style="padding:5px 10px; font-size:0.85em" onclick="document.getElementById('img-upload').click()">ğŸ“·</button>
                    <button class="btn btn-outline" style="padding:5px 10px; font-size:0.85em" onclick="doOCR()">ğŸ” OCR</button>
                    <div style="flex:1"></div>
                    <button class="btn btn-primary" style="padding:5px 15px" onclick="addNote()" data-i18n="btn_save">ä¿å­˜</button>
                </div>
                <div id="note-list" style="margin-top:15px; border-top:1px solid #eee; padding-top:10px"></div>
            </div>
        </div>

        <!-- List -->
        <div class="section-block" id="sec-list">
            <button class="pin-btn" onclick="togglePin('sec-list', this)">ğŸ“Œ</button>
            <div class="card">
                <div style="font-weight:bold; margin-bottom:10px" data-i18n="list_title">ä»»åŠ¡æ˜ç»†</div>
                <div class="filter-row">
                    <div class="custom-select mini-select" id="filter-tag" style="flex:1"></div>
                    <div class="custom-select mini-select" id="filter-cat" style="flex:1"></div>
                    <div class="custom-select mini-select" id="filter-status" style="flex:1"></div>
                </div>
                <div id="task-list"></div>
            </div>
        </div>

    </div>

    <!-- Settings -->
    <div class="modal" id="settings-modal" onclick="if(event.target===this) closeSettings()">
        <div class="modal-content">
            <h3 style="margin-top:0" data-i18n="set_title">å…¨å±€è®¾ç½®</h3>
            
            <div class="setting-item">
                <label class="setting-label">PCç«¯é¡µé¢å®½åº¦</label>
                <input type="range" min="375" max="1200" step="10" id="width-range" style="width:100%" oninput="setPcWidth(this.value)">
                <div style="text-align:right; font-size:0.8em; color:#999" id="width-val">600px</div>
            </div>

            <div class="setting-item">
                <label class="setting-label" data-i18n="set_lang">è¯­è¨€ / Language</label>
                <select id="lang-select" onchange="changeLang(this.value)" style="width:100%">
                    <option value="zh">ğŸ‡¨ğŸ‡³ ä¸­æ–‡</option>
                    <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                    <option value="jp">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
                    <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
                    <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
                </select>
            </div>

            <div class="setting-item">
                <label class="setting-label" data-i18n="set_backup">æ•°æ®ç®¡ç†</label>
                <div style="display:flex; gap:10px">
                    <button class="btn btn-outline" style="flex:1" onclick="exportData()">ğŸ“¤ <span data-i18n="btn_export">å¯¼å‡ºå¤‡ä»½</span></button>
                    <button class="btn btn-outline" style="flex:1" onclick="document.getElementById('file-import').click()">ğŸ“¥ <span data-i18n="btn_import">å¯¼å…¥æ¢å¤</span></button>
                    <input type="file" id="file-import" style="display:none" onchange="importData(this)">
                </div>
            </div>

            <div class="setting-item">
                <label class="setting-label" data-i18n="set_font">å­—ä½“å¤§å°</label>
                <input type="range" min="0.8" max="1.3" step="0.05" id="font-range" style="width:100%" oninput="setFont(this.value)">
            </div>
            
            <div class="setting-item">
                <label class="setting-label" data-i18n="set_radius">åœ†è§’å¤§å°</label>
                <input type="range" min="0" max="25" step="1" id="radius-range" style="width:100%" oninput="setRadius(this.value)">
            </div>

            <div class="setting-item">
                <label class="setting-label" data-i18n="set_color">è‡ªå®šä¹‰é¢œè‰²</label>
                <div style="display:flex; gap:15px; align-items:center;">
                    <span data-i18n="col_bg">èƒŒæ™¯</span> <input type="color" id="bg-color-picker" oninput="setBgColor(this.value)" style="height:30px">
                    <span data-i18n="col_card">å¡ç‰‡</span> <input type="color" id="card-color-picker" oninput="setCardColor(this.value)" style="height:30px">
                </div>
            </div>
            
            <button class="btn btn-primary" style="width:100%" onclick="closeSettings()" data-i18n="btn_close">å®Œæˆ</button>
        </div>
    </div>
<script>
        /* --- å¤šè¯­è¨€è¯å…¸ --- */
        const I18N = {
            zh: {
                title:'ä¸ªäººä»»åŠ¡çœ‹æ¿', todo:'å¾…åŠ', doing:'è¿›è¡Œä¸­', done:'å·²å®Œæˆ', dist:'å¤šç»´åˆ†å¸ƒ', stat_status:'çŠ¶æ€ç»Ÿè®¡', stat_urgency:'ç´§æ€¥åº¦ç»Ÿè®¡',
                add_title:'âš¡ å¿«é€Ÿæ·»åŠ ', add_ph:'è¦åšä»€ä¹ˆï¼Ÿ', btn_add:'æ·»åŠ ', note_title:'çµæ„Ÿ / ç¬”è®° / æˆªå›¾', note_ph:'åœ¨æ­¤è®°å½•ï¼Œè‡ªåŠ¨ä¿å­˜...', btn_save:'ä¿å­˜',
                list_title:'ä»»åŠ¡æ˜ç»†', set_title:'å…¨å±€è®¾ç½®', set_lang:'è¯­è¨€ / Language', set_backup:'æ•°æ®ç®¡ç†', btn_export:'å¯¼å‡ºå¤‡ä»½', btn_import:'å¯¼å…¥æ¢å¤',
                set_font:'å­—ä½“å¤§å°', set_radius:'åœ†è§’å¤§å°', set_color:'è‡ªå®šä¹‰é¢œè‰²', col_bg:'èƒŒæ™¯', col_card:'å¡ç‰‡', btn_close:'å®Œæˆ',
                opt_p1:'ğŸ”´ é‡è¦ä¸”ç´§æ€¥', opt_p2:'ğŸ”µ é‡è¦ä¸ç´§æ€¥', opt_p3:'ğŸŸ  ä¸é‡è¦ç´§æ€¥', opt_p4:'âšª æ™®é€šä»»åŠ¡',
                opt_work:'ğŸ’¼ å·¥ä½œ', opt_study:'ğŸ“š å­¦ä¹ ', opt_life:'ğŸ  ç”Ÿæ´»', opt_all_tag:'å…¨éƒ¨æ ‡ç­¾', opt_all_cat:'å…¨éƒ¨ç±»åˆ«', opt_all_sts:'å…¨éƒ¨çŠ¶æ€'
            },
            en: {
                title:'Life OS', todo:'Todo', doing:'Doing', done:'Done', dist:'Distribution', stat_status:'Status Stats', stat_urgency:'Urgency Stats',
                add_title:'âš¡ Quick Add', add_ph:'What needs to be done?', btn_add:'Add', note_title:'Ideas & Notes', note_ph:'Type here...', btn_save:'Save',
                list_title:'Task List', set_title:'Settings', set_lang:'Language', set_backup:'Data Backup', btn_export:'Export', btn_import:'Import',
                set_font:'Font Size', set_radius:'Corner Radius', set_color:'Custom Colors', col_bg:'Bg', col_card:'Card', btn_close:'Close',
                opt_p1:'ğŸ”´ Imp & Urg', opt_p2:'ğŸ”µ Imp & Not Urg', opt_p3:'ğŸŸ  Not Imp & Urg', opt_p4:'âšª Normal',
                opt_work:'ğŸ’¼ Work', opt_study:'ğŸ“š Study', opt_life:'ğŸ  Life', opt_all_tag:'All Tags', opt_all_cat:'All Cats', opt_all_sts:'All Status'
            },
            jp: {
                title:'ã‚¿ã‚¹ã‚¯ç®¡ç†', todo:'æœªç€æ‰‹', doing:'é€²è¡Œä¸­', done:'å®Œäº†', dist:'åˆ†å¸ƒ', stat_status:'çŠ¶æ…‹çµ±è¨ˆ', stat_urgency:'ç·Šæ€¥åº¦çµ±è¨ˆ',
                add_title:'âš¡ æ–°è¦ã‚¿ã‚¹ã‚¯', add_ph:'ä½•ã‚’ã—ã¾ã™ã‹ï¼Ÿ', btn_add:'è¿½åŠ ', note_title:'ãƒ¡ãƒ¢ãƒ»ã‚¢ã‚¤ãƒ‡ã‚¢', note_ph:'ã“ã“ã«å…¥åŠ›...', btn_save:'ä¿å­˜',
                list_title:'ã‚¿ã‚¹ã‚¯è©³ç´°', set_title:'è¨­å®š', set_lang:'è¨€èª', set_backup:'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—', btn_export:'å‡ºåŠ›', btn_import:'å–è¾¼',
                set_font:'æ–‡å­—ã‚µã‚¤ã‚º', set_radius:'è§’ä¸¸', set_color:'è‰²è¨­å®š', col_bg:'èƒŒæ™¯', col_card:'ã‚«ãƒ¼ãƒ‰', btn_close:'å®Œäº†',
                opt_p1:'ğŸ”´ é‡è¦ãƒ»ç·Šæ€¥', opt_p2:'ğŸ”µ é‡è¦ãƒ»éç·Šæ€¥', opt_p3:'ğŸŸ  è»½ãƒ»ç·Šæ€¥', opt_p4:'âšª æ™®é€š',
                opt_work:'ğŸ’¼ ä»•äº‹', opt_study:'ğŸ“š å‹‰å¼·', opt_life:'ğŸ  ç”Ÿæ´»', opt_all_tag:'å…¨ã‚¿ã‚°', opt_all_cat:'å…¨åˆ†é¡', opt_all_sts:'å…¨çŠ¶æ…‹'
            },
            fr: { title:'Tableau de bord', todo:'Ã€ faire', doing:'En cours', done:'Fait', dist:'Distribution', stat_status:'Statut', stat_urgency:'Urgence', add_title:'Ajout rapide', add_ph:'TÃ¢che...', btn_add:'Ajouter', note_title:'Notes', note_ph:'Ã‰crivez ici...', btn_save:'Sauver', list_title:'Liste', set_title:'ParamÃ¨tres', set_lang:'Langue', set_backup:'Sauvegarde', btn_export:'Exporter', btn_import:'Importer', set_font:'Taille police', set_radius:'Rayon', set_color:'Couleurs', col_bg:'Fond', col_card:'Carte', btn_close:'Fermer', opt_p1:'ğŸ”´ Imp & Urg', opt_p2:'ğŸ”µ Imp & Non Urg', opt_p3:'ğŸŸ  Non Imp & Urg', opt_p4:'âšª Normal', opt_work:'ğŸ’¼ Travail', opt_study:'ğŸ“š Ã‰tudes', opt_life:'ğŸ  Vie', opt_all_tag:'Tous', opt_all_cat:'Tous', opt_all_sts:'Tous' },
            es: { title:'Tablero', todo:'Por hacer', doing:'En curso', done:'Hecho', dist:'DistribuciÃ³n', stat_status:'Estado', stat_urgency:'Urgencia', add_title:'AÃ±adir', add_ph:'Tarea...', btn_add:'AÃ±adir', note_title:'Notas', note_ph:'Escriba aquÃ­...', btn_save:'Guardar', list_title:'Lista', set_title:'Ajustes', set_lang:'Idioma', set_backup:'Respaldo', btn_export:'Exportar', btn_import:'Importar', set_font:'TamaÃ±o fuente', set_radius:'Radio', set_color:'Colores', col_bg:'Fondo', col_card:'Tarjeta', btn_close:'Cerrar', opt_p1:'ğŸ”´ Imp & Urg', opt_p2:'ğŸ”µ Imp & No Urg', opt_p3:'ğŸŸ  No Imp & Urg', opt_p4:'âšª Normal', opt_work:'ğŸ’¼ Trabajo', opt_study:'ğŸ“š Estudio', opt_life:'ğŸ  Vida', opt_all_tag:'Todos', opt_all_cat:'Todos', opt_all_sts:'Todos' }
        };

        const COLORS = { p1:'#f54a45', p2:'#3370ff', p3:'#ff8800', p4:'#999', work:'#3370ff', study:'#9333ea', life:'#00b665', todo:'#ccc', doing:'#3370ff', done:'#00b665' };
        
        /* --- åˆå§‹åŒ– --- */
        let tasks = JSON.parse(localStorage.getItem('v7_tasks')) || [];
        let notes = JSON.parse(localStorage.getItem('v7_notes')) || [];
        let config = JSON.parse(localStorage.getItem('v7_config')) || { bgColor:'#f2f3f5', cardColor:'#ffffff', radius:12, font:1, lang:'zh', order:[], pcWidth:600, pinned:[] };
        let filters = { tag:'all', cat:'all', status:'all' };
        let tempImg = null;

        function init() {
            tryMigrateData(); // 1. å…¼å®¹æ—§æ•°æ®
            applyConfig();    // 2. åº”ç”¨æ ·å¼
            setupDrag();      // 3. æ‹–æ‹½é€»è¾‘
            setupClock();     // 4. æ—¶é’Ÿ
            updateLang();     // 5. è¯­è¨€
            
            // ä¸‹æ‹‰åˆå§‹åŒ–
            const t = I18N[config.lang];
            const OPT_TAG = [{v:'p1',t:t.opt_p1,c:'bg-p1',col:COLORS.p1}, {v:'p2',t:t.opt_p2,c:'bg-p2',col:COLORS.p2}, {v:'p3',t:t.opt_p3,c:'bg-p3',col:COLORS.p3}, {v:'p4',t:t.opt_p4,c:'bg-p4',col:COLORS.p4}];
            const OPT_CAT = [{v:'work',t:t.opt_work,c:'bg-work',col:COLORS.work}, {v:'study',t:t.opt_study,c:'bg-study',col:COLORS.study}, {v:'life',t:t.opt_life,c:'bg-life',col:COLORS.life}];
            
            renderSelect('sel-add-tag', OPT_TAG, 'p4');
            renderSelect('sel-add-cat', OPT_CAT, 'life');
            
            document.getElementById('note-input').addEventListener('paste', handlePaste);
            renderAll();
        }

        /* --- æ•°æ®è¿ç§» (å…¼å®¹æ—§ç‰ˆæœ¬) --- */
        function tryMigrateData() {
            if(localStorage.getItem('v7_tasks')) return; // å·²æœ‰æ•°æ®ï¼Œæ— éœ€è¿ç§»
            const keys = ['v6_','v5_','lifeos_','perfect_','final_'];
            for(let k of keys) {
                if(localStorage.getItem(k+'tasks')) {
                    tasks = JSON.parse(localStorage.getItem(k+'tasks')) || [];
                    notes = JSON.parse(localStorage.getItem(k+'notes')) || [];
                    const oldConf = JSON.parse(localStorage.getItem(k+'config'));
                    if(oldConf) {
                        config.bgColor = oldConf.bgColor || config.bgColor;
                        config.cardColor = oldConf.cardColor || config.cardColor;
                        config.radius = oldConf.radius || config.radius;
                        config.font = oldConf.font || config.font;
                    }
                    save(); // ä¿å­˜åˆ° v7
                    break;
                }
            }
        }

        /* --- æ¸²æŸ“ --- */
        function renderAll() {
            const t = I18N[config.lang];
            const OPT_TAG = [{v:'p1',t:t.opt_p1,c:'bg-p1',col:COLORS.p1}, {v:'p2',t:t.opt_p2,c:'bg-p2',col:COLORS.p2}, {v:'p3',t:t.opt_p3,c:'bg-p3',col:COLORS.p3}, {v:'p4',t:t.opt_p4,c:'bg-p4',col:COLORS.p4}];
            const OPT_CAT = [{v:'work',t:t.opt_work,c:'bg-work',col:COLORS.work}, {v:'study',t:t.opt_study,c:'bg-study',col:COLORS.study}, {v:'life',t:t.opt_life,c:'bg-life',col:COLORS.life}];
            const OPT_STATUS = [{v:'todo',t:t.todo,c:'bg-todo',col:COLORS.todo}, {v:'doing',t:t.doing,c:'bg-doing',col:COLORS.doing}, {v:'done',t:t.done,c:'bg-done',col:COLORS.done}];

            // åˆå§‹åŒ–ç­›é€‰
            renderSelect('filter-tag', [{v:'all',t:t.opt_all_tag,c:'',col:'#ccc'}].concat(OPT_TAG), filters.tag, v=>{filters.tag=v;renderList(OPT_TAG,OPT_CAT,OPT_STATUS)});
            renderSelect('filter-cat', [{v:'all',t:t.opt_all_cat,c:'',col:'#ccc'}].concat(OPT_CAT), filters.cat, v=>{filters.cat=v;renderList(OPT_TAG,OPT_CAT,OPT_STATUS)});
            renderSelect('filter-status', [{v:'all',t:t.opt_all_sts,c:'',col:'#ccc'}].concat(OPT_STATUS), filters.status, v=>{filters.status=v;renderList(OPT_TAG,OPT_CAT,OPT_STATUS)});

            renderKPI();
            renderCharts(OPT_TAG, OPT_CAT, OPT_STATUS);
            renderList(OPT_TAG, OPT_CAT, OPT_STATUS);
            renderNotes();
            updatePinState();
        }

        function renderKPI() {
            const count = s => tasks.filter(t=>t.status===s).length;
            document.getElementById('kpi-todo').innerText = count('todo');
            document.getElementById('kpi-doing').innerText = count('doing');
            document.getElementById('kpi-done').innerText = count('done');
        }

        // ç‚¹å‡» KPI ç­›é€‰å¹¶è·³è½¬
        function filterByStat(status) {
            filters.status = status;
            // æ›´æ–°ä¸‹æ‹‰æ¡†UI
            const t = I18N[config.lang];
            const OPT_STATUS = [{v:'todo',t:t.todo,c:'bg-todo',col:COLORS.todo}, {v:'doing',t:t.doing,c:'bg-doing',col:COLORS.doing}, {v:'done',t:t.done,c:'bg-done',col:COLORS.done}];
            const allOpts = [{v:'all',t:t.opt_all_sts,c:'',col:'#ccc'}].concat(OPT_STATUS);
            renderSelect('filter-status', allOpts, status, v=>{filters.status=v;renderList()});
            
            renderAll(); // åˆ·æ–°æ•´ä¸ªç•Œé¢
            document.getElementById('sec-list').scrollIntoView({behavior:'smooth'});
        }

        function renderCharts(tags, cats, stats) {
            const calc = (arr,k) => arr.reduce((a,c)=>{a[c[k]]=(a[c[k]]||0)+1;return a},{});
            drawPie('pie-tag','leg-tag',calc(tasks,'tag'),tags);
            drawPie('pie-cat','leg-cat',calc(tasks,'cat'),cats);
            drawPie('pie-status','leg-status',calc(tasks,'status'),stats);
            drawBar('bar-status-chart','bar-status-leg',calc(tasks,'status'),stats);
            drawBar('bar-urgency-chart','bar-urgency-leg',calc(tasks,'tag'),tags);
        }

        function drawPie(cid,lid,data,opts) {
            const total = tasks.length||1;
            let stops=[], curr=0, leg='';
            opts.forEach(o => {
                const c = data[o.v]||0;
                if(c>0) {
                    const pct=(c/total)*100;
                    stops.push(`${o.col} ${curr}% ${curr+pct}%`);
                    curr+=pct;
                }
                leg += `<div class="legend-item"><div class="legend-color" style="background:${o.col}"></div><div>${o.t}</div></div>`;
            });
            const grad = stops.length ? `conic-gradient(${stops.join(', ')})` : `conic-gradient(#eee 0% 100%)`;
            document.getElementById(cid).style.background = grad;
            document.getElementById(lid).innerHTML = leg;
        }

        function drawBar(cid,lid,data,opts) {
            const el=document.getElementById(cid), leg=document.getElementById(lid);
            el.innerHTML=''; leg.innerHTML='';
            const max = Math.max(...Object.values(data))||1;
            opts.forEach(o => {
                const c=data[o.v]||0;
                const h=(c/max)*100;
                el.innerHTML += `<div class="bar-col"><div class="bar-fill" style="height:${h}%; background:${o.col}"></div></div>`;
                leg.innerHTML += `<div class="legend-item"><div class="legend-color" style="background:${o.col}"></div><div>${o.t}</div></div>`;
            });
        }

        function renderList(tags, cats, stats) {
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            
            let res = tasks.filter(t => 
                (filters.tag==='all'||t.tag===filters.tag) &&
                (filters.cat==='all'||t.cat===filters.cat) &&
                (filters.status==='all'||t.status===filters.status)
            );
            const score = {doing:0, todo:1, done:2};
            res.sort((a,b)=> score[a.status]-score[b.status] || a.tag.localeCompare(b.tag));

            res.forEach(t => {
                const i = tasks.indexOf(t);
                const div = document.createElement('div');
                div.className = 'task-item';
                let subHtml = '';
                if(t.sub && t.sub.length) {
                    subHtml = `<div class="subtasks ${t.showSub?'show':''}">${t.sub.map((s,si)=>`
                        <div class="sub-item"><input type="checkbox" ${s.done?'checked':''} onchange="toggleSub(${i},${si})"><input class="seamless-input" value="${s.text}" onchange="updateSub(${i},${si},this.value)" style="text-decoration:${s.done?'line-through':'none'};color:${s.done?'#ccc':'inherit'}"></div>
                    `).join('')}</div>`;
                }
                div.innerHTML = `
                    <div class="task-header">
                        <input class="task-title-input seamless-input ${t.status==='done'?'done':''}" value="${t.name}" onchange="updateTask(${i},'name',this.value)">
                        <button onclick="delTask(${i})" style="border:none;background:none;color:#ccc;font-size:1.2em">Ã—</button>
                    </div>
                    <div class="task-meta"><span>ğŸ“… ${t.date}</span> <span>â° ${t.time}</span></div>
                    <div class="task-ctrls">
                        <div class="custom-select mini-select" id="s-tag-${i}"></div>
                        <div class="custom-select mini-select" id="s-cat-${i}"></div>
                        <div class="custom-select mini-select" id="s-sts-${i}"></div>
                        <button class="btn btn-text" style="font-size:0.8em;border:1px solid #eee" onclick="toggleSubBox(${i})">ğŸ“‹ ${t.sub.length}</button>
                        <button class="btn btn-text" style="color:var(--blue);font-size:1.2em" onclick="promptSub(${i})">+</button>
                    </div>${subHtml}`;
                list.appendChild(div);
                renderSelect(`s-tag-${i}`, tags, t.tag, v=>updateTask(i,'tag',v));
                renderSelect(`s-cat-${i}`, cats, t.cat, v=>updateTask(i,'cat',v));
                renderSelect(`s-sts-${i}`, stats, t.status, v=>updateTask(i,'status',v));
            });
        }

        function renderNotes() {
            const el = document.getElementById('note-list');
            el.innerHTML = notes.map((n, i) => `
                <div class="note-item">
                    <div style="font-size:0.8em; color:#999; display:flex; justify-content:space-between; margin-bottom:5px">
                        <span>${n.date} ${n.time}</span>
                        <span onclick="delNote(${i})" style="color:#ff4d4f; cursor:pointer">åˆ é™¤</span>
                    </div>
                    <textarea class="note-edit-area" onchange="updateNote(${i},this.value)" rows="${n.text.split('\n').length || 1}">${n.text}</textarea>
                    ${n.img ? `<img src="${n.img}" class="note-thumb" onclick="viewImage(this.src)" style="margin-top:8px">` : ''}
                </div>
            `).join('');
        }

        /* --- ä¸šåŠ¡é€»è¾‘ --- */
        function getNow() { const n = new Date(); return { d: n.toISOString().split('T')[0], t: n.toTimeString().slice(0,5) }; }

        function addTask() {
            const title = document.getElementById('add-title').value;
            if(!title) return alert('Input Required');
            const now = getNow();
            tasks.unshift({
                id: Date.now(), name: title, date: now.d, time: now.t,
                tag: document.getElementById('sel-add-tag').dataset.val || 'p4',
                cat: document.getElementById('sel-add-cat').dataset.val || 'life',
                status: 'todo', sub: [], showSub: false
            });
            document.getElementById('add-title').value='';
            save(); renderAll();
        }

        function updateTask(i, k, v) { tasks[i][k] = v; const n=getNow(); tasks[i].date=n.d; tasks[i].time=n.t; save(); renderList(); }
        function delTask(i) { if(confirm('Del?')) { tasks.splice(i,1); save(); renderAll(); } }
        
        async function addNote() {
            const txt = document.getElementById('note-input').value;
            if(!txt && !tempImg) return;
            const now = getNow();
            try {
                notes.unshift({id: Date.now(), text: txt, img: tempImg, date: now.d, time: now.t});
                save(); 
                document.getElementById('note-input').value='';
                document.getElementById('note-preview-area').innerHTML='';
                tempImg=null;
                renderNotes();
            } catch(e) { alert('Storage Full! Image too large.'); notes.shift(); }
        }

        function updateNote(i, val) { notes[i].text = val; const n=getNow(); notes[i].date=n.d; notes[i].time=n.t; save(); }
        function delNote(i) { if(confirm('Del?')){ notes.splice(i,1); save(); renderNotes(); } }

        function compressImage(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX = 800;
                        let w = img.width, h = img.height;
                        if(w > MAX) { h *= MAX/w; w = MAX; }
                        canvas.width = w; canvas.height = h;
                        ctx.drawImage(img, 0, 0, w, h);
                        resolve(canvas.toDataURL('image/jpeg', 0.7));
                    };
                };
            });
        }
        
        async function handleImgUpload(inp) { if(inp.files[0]) { tempImg = await compressImage(inp.files[0]); document.getElementById('note-preview-area').innerHTML=`<img src="${tempImg}" class="note-thumb" onclick="viewImage(this.src)">`; } }
        async function handlePaste(e) { 
            for(let item of e.clipboardData.items) { 
                if(item.type.startsWith('image')) { tempImg = await compressImage(item.getAsFile()); document.getElementById('note-preview-area').innerHTML=`<img src="${tempImg}" class="note-thumb" onclick="viewImage(this.src)">`; } 
            } 
        }
        function viewImage(src) { document.getElementById('lightbox-img').src=src; document.getElementById('lightbox').style.display='flex'; }
        
        async function doOCR() {
            if(!tempImg) return alert('Upload Img First');
            const btn=document.querySelector('button[onclick="doOCR()"]'); const old=btn.innerText; btn.innerText='...';
            try { 
                const {data:{text}} = await Tesseract.recognize(tempImg, config.lang==='zh'?'chi_sim':'eng'); 
                // OCR ä¼˜åŒ–ï¼šç§»é™¤æ±‰å­—ä¹‹é—´çš„ç©ºæ ¼ï¼Œä¿ç•™è‹±æ–‡ç©ºæ ¼
                const cleanedText = text.replace(/([^\x00-\xff])\s+([^\x00-\xff])/g, '$1$2');
                document.getElementById('note-input').value += '\n'+cleanedText; 
            } catch(e){ alert('Need Network'); }
            btn.innerText=old;
        }

        function toggleSubBox(i){tasks[i].showSub=!tasks[i].showSub;renderAll();}
        function promptSub(i){const t=prompt('Subtask:');if(t){tasks[i].sub.push({text:t,done:false});tasks[i].showSub=true;save();renderAll();}}
        function toggleSub(ti,si){tasks[ti].sub[si].done=!tasks[ti].sub[si].done;save();renderAll();}
        function updateSub(ti,si,v){tasks[ti].sub[si].text=v;save();}

        /* --- è¾…åŠ© --- */
        function save() { localStorage.setItem('v7_tasks', JSON.stringify(tasks)); localStorage.setItem('v7_notes', JSON.stringify(notes)); localStorage.setItem('v7_config', JSON.stringify(config)); }
        function setupClock() { setInterval(()=>document.getElementById('sys-clock').innerText=new Date().toLocaleTimeString(),1000); }
        
        /* å›ºå®šå¡ç‰‡åŠŸèƒ½ */
        function togglePin(id, btn) {
            const el = document.getElementById(id);
            if(config.pinned && config.pinned.includes(id)) {
                config.pinned = config.pinned.filter(x => x !== id);
            } else {
                if(!config.pinned) config.pinned = [];
                config.pinned.push(id);
            }
            save(); updatePinState();
        }
        function updatePinState() {
            document.querySelectorAll('.section-block').forEach(el => {
                const btn = el.querySelector('.pin-btn');
                if(config.pinned && config.pinned.includes(el.id)) {
                    el.classList.add('pinned');
                    if(btn) btn.classList.add('active');
                } else {
                    el.classList.remove('pinned');
                    if(btn) btn.classList.remove('active');
                }
            });
        }

        /* æ‹–æ‹½ä¼˜åŒ– (å›ºå®šå¡ç‰‡ä¸å¯æ‹–) */
        function setupDrag() {
            const con = document.getElementById('app-container');
            let timer, dragEl, startY;
            document.querySelectorAll('.section-block').forEach(el => {
                el.addEventListener('touchstart', e => {
                    if(['INPUT','BUTTON','TEXTAREA','SELECT'].includes(e.target.tagName) || e.target.closest('.custom-select')) return;
                    // å›ºå®šå¡ç‰‡ä¸è§¦å‘é•¿æŒ‰
                    if(el.classList.contains('pinned')) return;
                    
                    startY = e.touches[0].clientY;
                    timer = setTimeout(() => { dragEl=el; el.classList.add('dragging'); navigator.vibrate?.(50); }, 600);
                }, {passive:true});
                
                el.addEventListener('touchmove', e => {
                    if(!dragEl && Math.abs(e.touches[0].clientY - startY) > 5) { clearTimeout(timer); return; }
                    if(dragEl) {
                        e.preventDefault();
                        const touch = e.touches[0];
                        if(touch.clientY < 50) window.scrollBy(0, -10);
                        if(touch.clientY > window.innerHeight - 50) window.scrollBy(0, 10);
                        const t = document.elementFromPoint(touch.clientX, touch.clientY)?.closest('.section-block');
                        if(t && t !== dragEl && con.contains(t)) {
                            // é‡åˆ°å›ºå®šå¡ç‰‡è·³è¿‡äº¤æ¢
                            if(t.classList.contains('pinned')) return;
                            const all = [...con.children];
                            all.indexOf(dragEl) < all.indexOf(t) ? t.after(dragEl) : t.before(dragEl);
                        }
                    }
                }, {passive:false});
                
                el.addEventListener('touchend', () => { 
                    clearTimeout(timer); 
                    if(dragEl) { dragEl.classList.remove('dragging'); config.order=[...con.children].map(c=>c.id); save(); } 
                    dragEl = null; 
                });
            });
            if(config.order) config.order.forEach(id=>con.appendChild(document.getElementById(id)));
        }

        function renderSelect(id, opts, val, cb) {
            const el=document.getElementById(id); if(!el) return;
            const cur=opts.find(o=>o.v===val)||opts[0];
            el.innerHTML=`<div class="select-trigger ${cur.c}" onclick="toggleSelect('${id}')">${cur.t}</div>
                <div class="select-options">${opts.map(o=>`<div class="select-option" onclick="selectOption('${id}','${o.v}')"><span class="color-dot" style="background:${o.col}"></span>${o.t}</div>`).join('')}</div>`;
            el.dataset.val=val; el.onchangeCallback=cb;
        }
        function toggleSelect(id) { document.querySelectorAll('.select-options').forEach(e=>e.parentElement.id!==id&&e.classList.remove('open')); document.querySelector(`#${id} .select-options`).classList.toggle('open'); }
        function selectOption(id,v) { 
            const el=document.getElementById(id); el.dataset.val=v; 
            document.querySelector(`#${id} .select-options`).classList.remove('open');
            if(el.onchangeCallback) el.onchangeCallback(v);
        }
        document.addEventListener('click',e=>{if(!e.target.closest('.custom-select'))document.querySelectorAll('.select-options').forEach(x=>x.classList.remove('open'))});

        function openSettings(){document.getElementById('settings-modal').style.display='flex';}
        function closeSettings(){document.getElementById('settings-modal').style.display='none';save();}
        function exportData(){ const n=prompt("Filename:","backup_"+new Date().toISOString().slice(0,10)); if(n){const b=new Blob([JSON.stringify({tasks,notes,config})],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=`${n}.json`;a.click();} }
        function importData(i){const f=i.files[0];if(f){const r=new FileReader();r.onload=e=>{try{const d=JSON.parse(e.target.result);tasks=d.tasks||[];notes=d.notes||[];if(d.config)config=d.config;save();location.reload();}catch(x){alert('Error')}};r.readAsText(f);}}
        
        function changeLang(l) { config.lang=l; updateLang(); renderAll(); save(); }
        function updateLang() {
            const t = I18N[config.lang];
            document.querySelectorAll('[data-i18n]').forEach(e=>e.innerText=t[e.dataset.i18n]);
            document.querySelectorAll('[data-i18n-ph]').forEach(e=>e.placeholder=t[e.dataset.i18nPh]);
            document.getElementById('lang-select').value = config.lang;
        }

        function applyConfig(){
            const r=document.documentElement.style;
            r.setProperty('--bg-body',config.bgColor);r.setProperty('--bg-card',config.cardColor);
            r.setProperty('--radius',config.radius+'px');r.setProperty('--font-scale',config.font);
            r.setProperty('--pc-width', (config.pcWidth||600)+'px');
            document.getElementById('bg-color-picker').value=config.bgColor;
            document.getElementById('card-color-picker').value=config.cardColor;
            document.getElementById('radius-range').value=config.radius;
            document.getElementById('font-range').value=config.font;
            document.getElementById('width-range').value=config.pcWidth||600;
            document.getElementById('width-val').innerText=(config.pcWidth||600)+'px';
        }
        function setBgColor(v){config.bgColor=v;applyConfig();}
        function setCardColor(v){config.cardColor=v;applyConfig();}
        function setRadius(v){config.radius=v;applyConfig();}
        function setFont(v){config.font=v;applyConfig();}
        function setPcWidth(v){config.pcWidth=v;applyConfig();}

        init();
    </script>
</body>
</html>
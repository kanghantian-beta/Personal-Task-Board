/* --- 保持原有所有样式不变，只在末尾增加以下样式 --- */

/* ... (这里是你之前的 CSS 内容，请确保保留) ... */

:root {
    --bg-body: #f2f3f5; --bg-card: #ffffff; --text-main: #1f2329; --text-sub: #8f959e;
    --radius: 12px; --font-scale: 1; --pc-width: 600px;
    --blue: #3370ff; --green: #00b665; --red: #f54a45; --orange: #ff8800; --purple: #9333ea; --border: #dee0e3;
}
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    background-color: var(--bg-body); color: var(--text-main); margin: 0; padding: 0;
    font-size: calc(14px * var(--font-scale)); display: flex; justify-content: center; min-height: 100vh;
}

#viewport-wrapper { width: 100%; max-width: var(--pc-width); padding: 15px; padding-bottom: 120px; transition: max-width 0.2s ease; }
#app-container { display: flex; flex-direction: column; gap: 15px; position: relative; }

/* 拖拽与层级 */
.section-block { touch-action: pan-y; transition: transform 0.2s, box-shadow 0.2s; position: relative; background: transparent; z-index: 1; }
.section-block.dragging { opacity: 0.9; transform: scale(1.02); z-index: 2000 !important; box-shadow: 0 15px 30px rgba(0,0,0,0.15); user-select: none; }
.section-block.pinned { position: sticky; top: 0; z-index: 1000; margin-bottom: 10px; border-radius: var(--radius); }
.section-block.pinned .card { border: 2px solid var(--blue); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
.section-block.z-top { z-index: 1500 !important; }
.pin-btn { position: absolute; top: 10px; right: 10px; z-index: 10; background: transparent; border: none; font-size: 1.2em; cursor: pointer; opacity: 0.3; }
.section-block.pinned .pin-btn { opacity: 1; transform: scale(1.1); }

/* 组件 */
.card { background: var(--bg-card); border-radius: var(--radius); padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); border: 1px solid var(--border); position: relative; }
.btn { border: none; border-radius: var(--radius); padding: 8px 16px; font-weight: bold; cursor: pointer; display: inline-flex; align-items: center; justify-content: center; white-space: nowrap; font-size: 0.95em; }
.btn-primary { background: var(--blue); color: white; }
.btn-outline { border: 1px solid var(--border); background: transparent; color: var(--text-main); }
.btn-text { background: transparent; color: var(--text-sub); }
.icon-btn { font-size: 1.4em; padding: 5px; }
.btn-icon-text span:first-child { margin-right: 5px; }

input, textarea, select { border: 1px solid var(--border); border-radius: var(--radius); padding: 10px; font-size: 1em; background: var(--bg-card); width: 100%; outline: none; transition: border-color 0.2s; font-family: inherit; }
input:focus, textarea:focus { border-color: var(--blue); }
.seamless-input { border: 1px solid transparent; background: transparent; padding: 2px 4px; margin: -2px; width: 100%; }
.seamless-input:focus { border: 1px solid var(--blue); background: #fff; border-radius: 4px; }

/* 顶部与标题 */
.app-title-edit { font-weight: 800; font-size: 1.4em; border: none !important; background: transparent !important; padding: 0 !important; width: auto !important; color: inherit; }
.top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.sys-time { font-size: 0.9em; color: var(--text-sub); font-family: monospace; font-weight: bold; }
.sync-info { display: flex; align-items: center; gap: 5px; font-size: 0.8em; margin-top: 2px; }
#current-room-id { color: #999; cursor: pointer; text-decoration: underline; }

/* KPI & Charts */
.kpi-row { display: flex; gap: 10px; }
.kpi-item { flex: 1; text-align: center; cursor: pointer; border-radius: 8px; transition: background 0.2s; padding: 5px 0;}
.kpi-item:active { background: #f0f0f0; }
.big-num { font-size: 1.8em; font-weight: 800; line-height: 1.2; }
.label-text { font-size: 0.8em; color: var(--text-sub); margin-top: 4px; }

.charts-container { display: flex; flex-direction: column; gap: 20px; }
.chart-sec-title { font-size: 0.9em; font-weight: bold; border-left: 3px solid var(--blue); padding-left: 8px; margin-bottom: 8px; }
.pie-row { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; }
.pie-card { flex: 1; min-width: 110px; background: #f9f9f9; padding: 10px; border-radius: var(--radius); display: flex; flex-direction: column; align-items: center; border: 1px solid #eee; }
.pie-chart { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff; margin-bottom: 8px; flex-shrink: 0; }
.legend-box { display: flex; flex-direction: column; gap: 4px; width: 100%; }
.legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.7em; color: #666; }
.legend-color { width: 8px; height: 8px; border-radius: 2px; flex-shrink: 0; }
.bar-chart-row { display: flex; gap: 10px; height: 140px; }
.bar-box { flex: 1; background: #f9f9f9; border-radius: var(--radius); padding: 10px; display: flex; flex-direction: column; border: 1px solid #eee; }
.bar-area { flex: 1; display: flex; align-items: flex-end; gap: 6px; margin-bottom: 5px; border-bottom: 1px solid #e0e0e0; padding-bottom: 2px; }
.bar-col { flex: 1; height: 100%; display: flex; flex-direction: column; justify-content: flex-end; align-items: center; }
.bar-fill { width: 100%; min-height: 4px; border-radius: calc(var(--radius)*0.4) calc(var(--radius)*0.4) 0 0; opacity: 0.9; transition: height 0.3s; }
.bar-legend-row { display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }

/* 下拉菜单 */
.custom-select { position: relative; cursor: pointer; user-select: none; min-width: 90px; }
.select-trigger { border: 1px solid var(--border); border-radius: var(--radius); padding: 8px 10px; background: var(--bg-card); display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; white-space: nowrap; overflow: hidden;}
.select-trigger::after { content: '▼'; font-size: 0.6em; color: #999; margin-left: 6px; }
.select-options { position: absolute; top: 105%; left: 0; min-width: 100%; background: var(--bg-card); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: 0 5px 15px rgba(0,0,0,0.1); 
    z-index: 9999; display: none; max-height: 250px; overflow-y: auto; 
}
.select-options.open { display: block; }
.select-option { padding: 10px; font-size: 0.9em; border-bottom: 1px solid #f5f5f5; display: flex; align-items: center; gap: 6px; }

/* 列表 */
.filter-row { display: flex; gap: 8px; margin-bottom: 12px; }
.task-item { padding: 12px; border-bottom: 1px solid #f0f0f0; display: flex; flex-direction: column; gap: 6px; }
.task-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; }
.task-title-input { font-size: 1.05em; font-weight: 500; border: none; background: transparent; padding: 0; width: 100%; }
.task-title-input.done { text-decoration: line-through; color: #ccc; }
.task-meta { display: flex; align-items: center; gap: 5px; font-size: 0.8em; color: #999; margin-top:2px; }
.task-ctrls { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; margin-top: 4px; }
.mini-select .select-trigger { padding: 3px 8px; font-size: 0.8em; min-width: auto; height: 26px; }
.subtasks { margin-top: 5px; padding-left: 10px; border-left: 2px solid #eee; display: none; }
.subtasks.show { display: block; }
.sub-item { display: flex; align-items: center; gap: 8px; margin-top: 6px; font-size: 0.9em; }

/* 笔记 */
.note-preview-area { display: flex; gap: 10px; flex-wrap: wrap; margin: 10px 0; }
.note-thumb { height: 60px; border-radius: 6px; border: 1px solid #eee; cursor: zoom-in; object-fit: cover; }
.note-item { margin-bottom: 12px; padding: 12px; background: #f9f9f9; border-radius: 8px; border: 1px solid #eee; }
.note-edit-area { width: 100%; background: transparent; border: none; resize: vertical; font-size: 0.95em; line-height: 1.5; font-family: inherit; }
.note-toolbar { display: flex; gap: 8px; align-items: center; margin-top: 5px; }
.lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 4000; display: none; justify-content: center; align-items: center; cursor: zoom-out; }
.lightbox img { max-width: 95%; max-height: 95%; border-radius: 4px; }

/* 登录/欢迎全屏弹窗 */
.fullscreen-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f2f3f5; z-index: 5000; display: flex; justify-content: center; align-items: center; }
.login-box { background: #fff; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 90%; max-width: 400px; text-align: center; }
.big-input { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 12px; font-size: 1.2em; margin: 20px 0; text-align: center; }
.big-input:focus { border-color: var(--blue); }

/* 弹窗通用 */
.custom-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 3100; }
.custom-modal-content { background: #fff; width: 90%; max-width: 400px; border-radius: var(--radius); padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); animation: popIn 0.2s ease; }
@keyframes popIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
.modal-footer { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
.settings-content { position: absolute; bottom: 0; left: 0; width: 100%; max-width: 100%; border-radius: 20px 20px 0 0; animation: slideUp 0.3s; max-height: 85vh; overflow-y: auto; }
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
.setting-item { margin-bottom: 20px; border-bottom: 1px solid #f0f0f0; padding-bottom: 15px; }
.setting-label { display: block; font-weight: bold; margin-bottom: 8px; }

/* 颜色 */
.bg-p1 { background: #fee2e2; color: #dc2626; } .bg-p2 { background: #dbeafe; color: #2563eb; } 
.bg-p3 { background: #fef3c7; color: #d97706; } .bg-p4 { background: #f3f4f6; color: #4b5563; }
.bg-work { background: #eff6ff; color: var(--blue); } .bg-study { background: #f3e8ff; color: var(--purple); } 
.bg-life { background: #dcfce7; color: var(--green); }
.bg-todo { background: #f5f5f5; color: #666; } .bg-doing { background: #e0edff; color: var(--blue); }
.bg-done { background: #dcfce7; color: var(--green); }